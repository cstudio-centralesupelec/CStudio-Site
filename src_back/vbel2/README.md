# VBel2

VBel2 helps you quickly build complex APIs that easily integrate with your frontend.

## Overview

VBel2 stands for Vanyle's BackEnd Library 2. It is a framework to build backends in NodeJS. VBel2 allows you to quickly build complex websites with minimal effort for your backend. 

Most website are just an interface between a user and a database. The only job of the backend is to make sure that the users have proper authorizations to read or edit the database. It's from this observation that VBel2 was built.

With VBel2, you just describe what your database looks like, things like:

- Your tables
- The fields in those tables
- The relationships between the fields
- The permissions required to read or edit the fields

And VBel2 will automatically create the database with the layout provided, create all the endpoints needed to do the actions you specified and generate all the documentation needed to use those endpoints. VBel2 will also generate some JavaScript for your client so that the client can call these backend functions without having to think.

It's as if the client can simply call function or access variables that exist server-side as long as the types of the arguments are correct and that the client has sufficient authorizations.

Of course, VBel2 also allows you to also create your own endpoints, if you want to do more than reading or writing data.

You can easily integrate VBel2 into any existing application as you can use as many or as little of VBel2's features as you need. VBel2 acts just as any `express` middleware, so you can just add `app.use(vbel)` to your app and you're ready to go.

## Using VBel2 to create endpoints

Let's say you have a nodejs application built with express and you want to add a new endpoint.
For example, an endpoint that returns a random number from the server. 

You could write something like this:
```js
let app = express();

// Setup app here ... serve static file or something ...

let vbel = new VBel();
vbel.endpoint(
    "rnd_number", // name of the endpoint
    {
        min:{type:"number"}, // variables of the endpoint
        max:{type:"number"};
    },
    (obj,req,res) => {
        // behavior of the endpoint
        // VBel does all the typechecking for you.
        let nbr = Math.random() * (obj.max - obj.min) + obj.min;
        vbel.sendResult(res,nbr);
    }
);

app.use(vbel);

app.listen(8080);

```

And on the client size, you can have:
```html
<html>
    ... Your page
    <script src="/client.js"></script> <!-- script generated by VBel to access your endpoints -->
    <script>
        async function main(){
            let nbr = await rnd_number(0,100); // call the endpoint defined previously.
            console.log(nbr.result) // => access the result.
            let badType = await rnd_number("hello","world");
            console.log(nbr.error); // => notice that proper typing is required.
        }
        main();
    </script>
</html>
```


## Using VBel2 to manage SQL tables

Sometime, you need more than just calling server side functions from the client,
you need to access some SQL tables.

Well, VBel2 got you covered. You can define an SQL scheme inside your javascript and
VBel2 will generate all the endpoints needed to use the scheme you defined.

VBel2 will make all the necessery checks and SQL requests so that everything works.

```js
let vbel = new VBel({/* config */});
// the use of singular is recommended when creating tables.
vbel.table("user",{
    isuser:true, // the table describes a connected client
    fields:{
        name:{
        	read:"all", // everybody can read this field
        	write:"none" // nobody can write this field
        	// read:all and write:none and the default
    	},
    	birth:{
            type:"date",
            read:{"match":"id"} // only a client with the matching user id can read this.
            // aka nobody except the current client.
            write: (userid,currentObject) => { // custom function returning a bool if you need more control
        		// userid is the id of the connected client making the request. It's null if the client is not logged in.
        		// currentObject is a JS object containing the fields of the object we are trying to access.
        		return areFriends(userid,currentObject.id);
		   }
        }
    },
    methods:{
        create:{}, // generate a handle to create a client
        remove:{
            handle: () => {
                // specify a custom function that will remove a client
                // useful if you need to do more than just an SQL DELETE call.
            }
        }, // generate a handle to remove a client
        list:{
            permission:"all" // specify permission for this endpoint. This has the same format as read / write
        } // generate a handle to list all clients
    }
});

```

## Access documentation

Because VBel2 is aware of all the endpoints you create, their types and the database scheme,
VBel2 can provide you with all the documentation you need about all the endpoints.

Just do `new VBel({doc:true})` when creating the VBel object and go to `/doc` to access the documentation page.
This page will list all the endpoints available, their arguments, the permission required to use them and more !


## VBel2 + Websockets = ðŸ’–

Sometimes, you want to notify your client that something happend.
You might be building a Collaborative editing app or a video game.

VBel2 provide 2 features to help you to this.
- Shared variables
- Client functions

Shared variables are variables that both the server and the client can access.
Depending on the variable you can specify read/write permissions.

Client function are client-side function that are called by the server.


Example of using a shared variable:
```js
// Server-side

vbel.enableWebsockets(server); // server is returned by createServer function

let text_content = vbel.sharedVariable("text_content",{
    read:"all", // same permission system as usual
    write:"none",
    maxlength:10, // minlength also available
    type:"string" // only string and number allowed.
});
text_content = "Hello, world!";

// Client-side
let text_content = getServerVariable("text_content");
// Note that the value of text_content might change, it's not a normal JS variable
console.log(text_content);

```
Note that every client has access to the same shared variable.
You might need to have client specific variables.
```js
let user_text = vbel.sharedUserVariable("user_text",{
    read:"all",
    write:{"match":"id"}
    // ...
});

// Client-side
let id = user_id(); // define an endpoint to get id of current user
let other_ids = other_ids();
let my_text = getServerUserVariable("user_text",id);
let other_text = getServerUserVariable("user_text",other_ids[0]);

console.log(my_text,other_text); // ok
my_text = "bluck"; // ok

other_text = "blick"; // not ok !! error.

```

## Documentation

For complete documentation of all the options available, checkout `DOC.md`
Also, if you need examples, see `test.js`